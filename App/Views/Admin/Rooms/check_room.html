{% extends "admin_base.html" %}

{% block title %} {{room.local_name}} {% endblock %}
{% block page_heading %} {{room.local_name}} {% endblock %}
{% block page_subheading %} edit {% endblock %}


{% block body %}


<!-- ENABLE BOOTSTRAP BUTTON CONFIRMATION AND AJAX -->
<script>

    $(document).ready(function () {

        $('[data-toggle=confirmation]').confirmation({
            rootSelector: '[data-toggle=confirmation]'
        });



        // get id from a clicked button to process it through ajax
         $('.btn-popup-right').click(function () {

            var pictureId = ($(this).attr('id'));
            var roomId = getParameterByName('id');

            // set picture as the main one
            $.ajax({
                url: '/admin/rooms/set-main-picture',
                data: {
                    picture_id: pictureId,
                    room_id: roomId
                },
                type: 'POST',
                success: function(data){

                    if(!data.error){
                        alert(pictureId);
                        alert(roomId);
                    }

                }
            });

             alert(pictureId);
             alert(roomId);

        });



    });

    // this function gets url parameter by name (we need id only)
    function getParameterByName( name ){
        var regexS = "[\\?&]"+name+"=([^&#]*)",
            regex = new RegExp( regexS ),
            results = regex.exec( window.location.search );
        if( results == null ){
            return "";
        } else{
            return decodeURIComponent(results[1].replace(/\+/g, " "));
        }
    }










</script>


<!-- POPUOTS -->
<script>

    $(function() {


        //----- OPEN
        $('[data-popup-open]').on('click', function(e)  {
            var targeted_popup_class = jQuery(this).attr('data-popup-open');
            $('[data-popup="' + targeted_popup_class + '"]').fadeIn(350);

            e.preventDefault();
        });

        //----- CLOSE
        $('[data-popup-close]').on('click', function(e)  {
            var targeted_popup_class = jQuery(this).attr('data-popup-close');
            $('[data-popup="' + targeted_popup_class + '"]').fadeOut(350);

            e.preventDefault();
        });

    });

</script>


<h3 class="head">Room's photos</h3>
<hr/>
<div class="row wrap" >

    {% for picture in pictures %}

    <a data-popup-open="popup-{{ picture.id }}" href="#"><img src="{{ picture.path }}" class="img-thumbnail room-edit"></a>

    <div class="popup" data-popup="popup-{{ picture.id }}">
        <div class="popup-inner">

            {% if picture.main == 1 %}
            <h2>This is the main picture</h2>
            {% elseif picture.main == 0 %}
            <h2>This is a secondary picture</h2>
            {% endif %}

            <div >
                <img class="popup-image" src="{{ picture.path }}" >
            </div>

            <a class="btn btn-md btn-danger btn-popup btn-popup-left" data-toggle="confirmation" data-title="Delete this picture?" data-popout="true" data-placement="bottom"
               href="/admin/rooms/delete-photo?id={{ picture.id }}" >Delete</a>

            {% if picture.main == 0 %}
            <a class="btn btn-primary btn-md btn-popup btn-popup-right " id="{{ picture.id }}" >Set as main photo</a>
            {% endif %}

            <a class="popup-close" data-popup-close="popup-{{ picture.id }}" href="#">x</a>
        </div>
    </div>


    {% endfor %}


</div>

<div class="row wrap">
    <h1>BOOKINGS</h1>
</div>



{% endblock %}

